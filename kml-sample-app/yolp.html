<html>
<head>

<!-- jquery/bootstrap/mine -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
<link rel="stylesheet" href="./style/map.css" type="text/css">

<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>

</head>
<body>
<div id="kml_tree">
	<ul>
		<li  id="kml_root" data-jstree='{"opened": true, "selected": true}'>111
		<ul>
			<li id="kml_0" data-jstree='{"icon": "jstree-file"}'>aaa</li>
			<li id="kml_1" data-jstree='{"icon": "jstree-file"}'>bbb</li>
			<li id="kml_2" data-jstree='{"icon": "jstree-file"}'>ccc</li>
			<li id="kml_3" data-jstree='{"icon": "jstree-file"}'>ddd</li>
			<li id="kml_4" data-jstree='{"icon": "jstree-file"}'>eee</li>
		</ul></li>
	</ul>
</div>
<div id="map"></div>

<script type="text/javascript" charset="utf-8" src="https://map.yahooapis.jp/js/V1/jsapi?appid=dj00aiZpPXNxSnVwYngxM1luNCZzPWNvbnN1bWVyc2VjcmV0Jng9YWU-"></script>

<script type="text/javascript">

var ymap;
var kmlLayers = new Array();

$(function () {
	$('#kml_tree').jstree({
		"plugins": ["checkbox"]
	});
});

$('#kml_tree').on("changed.jstree", function (e, data) {

	if (kmlLayers.length == 0) {
		return;
	}

	var checks = [];
	for(var i = 0; i < data.selected.length; i++) {
		var items = data.selected[i].split("_");
		var num = items[1];
		if (num == 'root') continue;
		checks[num] = num;
	}

	for(var i =0; i < kmlLayers.length; i++) {
		if (kmlLayers[i].visible === true) {
			if (typeof checks[i] === "undefined") {
				ymap.removeLayer(kmlLayers[i].layer);
				kmlLayers[i].visible = false;
			}
		} else {
			if (typeof checks[i] !== "undefined") {
				ymap.addLayer(kmlLayers[i].layer);
				kmlLayers[i].layer.execute();
				kmlLayers[i].visible = true;
			}
		}
	}

});

window.onload = function(){

	ymap = new Y.Map("map");

	ymap.setConfigure('doubleClickZoom', true);
	ymap.setConfigure('scrollWheelZoom', true);
	ymap.setConfigure('continuousZoom', true);
	ymap.setConfigure('weatherOverlay', true);

//	ymap.addControl(new Y.CenterMarkControl());
	ymap.addControl(new Y.LayerSetControl());
	ymap.addControl(new Y.ScaleControl());
	ymap.addControl(new Y.SliderZoomControlHorizontal());
	ymap.addControl(new Y.SearchControl());

//	ymap.drawMap(new Y.LatLng(37.864291, 140.672862), 17, Y.LayerSetId.NORMAL);
//	var kmlUrl = "http://anineco.nyanta.jp/example/routemap.kml";

//	ymap.drawMap(new Y.LatLng(35.17072677789611, 136.88260304318726), 17, Y.LayerSetId.NORMAL);
//	var kmlUrl = "http://www.nilab.info/f/0/20110830_sample.kml";

//	ymap.drawMap(new Y.LatLng(34.799902331988555, 135.3602957725525), 15, Y.LayerSetId.NORMAL);
	ymap.drawMap(new Y.LatLng(34.81123119501047, 135.35563945770264), 16, Y.LayerSetId.NORMAL);

	var kmlUrls = [
		"https://raw.githubusercontent.com/kon104/tzuka/master/kml-sample-data/hananomichi-1st.kml",
		"https://raw.githubusercontent.com/kon104/tzuka/master/kml-sample-data/hananomichi-2nd.kml",
		"https://raw.githubusercontent.com/kon104/tzuka/master/kml-sample-data/hananomichi-3rd.kml",
		"https://raw.githubusercontent.com/kon104/tzuka/master/kml-sample-data/hananomichi-4th.kml",
		"https://raw.githubusercontent.com/kon104/tzuka/master/kml-sample-data/yoneya.kml"
	];

	for(var i = 0; i < kmlUrls.length; i++)
	{
		var layer = new Y.GeoXmlLayer(kmlUrls[i]);
		ymap.addLayer(layer);
		layer.execute();
		kmlLayers.push({
			layer: layer,
			visible: true
		});
	}

}

</script>
</body>
</html>
